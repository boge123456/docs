---
title: "Veo-3 视频生成示例"
description: "使用 Veo-3 API 进行视频生成的完整示例代码"
---

# Veo-3 视频生成示例

以下示例展示如何使用 Veo-3模型生成高质量的视频内容。Veo-3是Google最新的视频生成模型，支持高分辨率、长时长的视频生成。

## 快速开始

<CodeGroup>

```bash cURL
# 1. 提交视频生成任务
curl -X POST "https://api.tokenops.ai/v1beta/models/veo-3.1-generate-preview:predictLongRunning" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <API-KEY>" \
  -d '{
    "instances": [
      {
        "prompt": "生成一个航海王路飞端着一条大鱼的短视频，背景是大海和天空"
      }
    ],
    "parameters": {
      "aspectRatio": "16:9",
      "durationSeconds": 4,
      "enhancePrompt": true,
      "resolution": "1080p",
      "sampleCount": 1,
      "seed": 12345,
      "compressionQuality": "OPTIMIZED"
    }
  }'

# 2. 查询任务状态
curl -X GET "https://api.tokenops.ai/v1beta/projects/gcp-quwan-gemini/locations/us-central1/publishers/google/models/veo-3.1-generate-preview/operations/{OPERATION_ID}" \
  -H "Authorization: Bearer <API-KEY>"
```


```python Python
import requests
import json
import time
import base64
from pathlib import Path

API_KEY = "<API-KEY>"
BASE_URL = "https://api.tokenops.ai/v1beta"

def generate_veo3_video(prompt, parameters=None):
    """
    使用Veo-3生成视频
    
    Args:
        prompt: 视频描述文本
        parameters: 视频生成参数
    
    Returns:
        任务操作信息
    """
    url = f"{BASE_URL}/models/veo-3.1-generate-preview:predictLongRunning"
    headers = {
        "Content-Type": "application/json",
        "Authorization": f"Bearer {API_KEY}"
    }
    
    # 默认参数
    default_parameters = {
        "aspectRatio": "16:9",
        "durationSeconds": 4,
        "enhancePrompt": True,
        "resolution": "1080p",
        "sampleCount": 1,
        "compressionQuality": "OPTIMIZED"
    }
    
    if parameters:
        default_parameters.update(parameters)
    
    data = {
        "instances": [
            {
                "prompt": prompt
            }
        ],
        "parameters": default_parameters
    }
    
    try:
        response = requests.post(url, headers=headers, json=data)
        
        if response.status_code == 200:
            result = response.json()
            print(f"Veo-3视频生成任务已启动")
            print(f"操作名称: {result.get('name', 'N/A')}")
            return result
        else:
            print(f"错误: {response.status_code} - {response.text}")
            return None
            
    except Exception as e:
        print(f"请求失败: {e}")
        return None

def check_veo3_operation_status(operation_name):
    """
    检查Veo-3操作状态
    
    Args:
        operation_name: 操作名称
        
    Returns:
        操作状态信息
    """
    # 提取operation_id
    operation_id = operation_name.split('/')[-1]
    url = f"{BASE_URL}/projects/gcp-quwan-gemini/locations/us-central1/publishers/google/models/veo-3.1-generate-preview/operations/{operation_id}"
    
    headers = {
        "Authorization": f"Bearer {API_KEY}"
    }
    
    try:
        response = requests.get(url, headers=headers)
        
        if response.status_code == 200:
            return response.json()
        else:
            print(f"查询失败: {response.status_code} - {response.text}")
            return None
            
    except Exception as e:
        print(f"查询请求失败: {e}")
        return None

def download_veo3_video(video_uri, output_path="veo3_generated_video.mp4"):
    """
    下载Veo-3生成的视频
    
    Args:
        video_uri: 视频URI（通常是base64编码的数据）
        output_path: 输出文件路径
        
    Returns:
        是否下载成功
    """
    try:
        if video_uri.startswith('data:'):
            # 处理base64编码的视频数据
            header, encoded = video_uri.split(',', 1)
            video_data = base64.b64decode(encoded)
            
            with open(output_path, "wb") as f:
                f.write(video_data)
            
            print(f"视频已保存: {output_path}")
            return True
        else:
            # 处理HTTP URL
            response = requests.get(video_uri)
            if response.status_code == 200:
                with open(output_path, "wb") as f:
                    f.write(response.content)
                print(f"视频已保存: {output_path}")
                return True
            else:
                print(f"下载失败: {response.status_code}")
                return False
                
    except Exception as e:
        print(f"下载失败: {e}")
        return False

def generate_veo3_video_complete(prompt, parameters=None, max_wait_time=600):
    """
    完整的Veo-3视频生成流程：生成 -> 等待 -> 下载
    
    Args:
        prompt: 视频描述文本
        parameters: 视频生成参数
        max_wait_time: 最大等待时间（秒）
        
    Returns:
        生成的视频文件路径
    """
    print("开始使用Veo-3生成视频...")
    
    # 1. 启动视频生成
    result = generate_veo3_video(prompt, parameters)
    if not result:
        return None
    
    operation_name = result.get('name')
    if not operation_name:
        print("未获取到操作名称")
        return None
    
    # 2. 等待视频生成完成
    print("正在生成视频，请耐心等待...")
    start_time = time.time()
    
    while time.time() - start_time < max_wait_time:
        status_info = check_veo3_operation_status(operation_name)
        if not status_info:
            break
        
        done = status_info.get('done', False)
        print(f"任务状态: {'完成' if done else '进行中'}")
        
        if done:
            # 检查是否有错误
            if 'error' in status_info:
                error_info = status_info['error']
                print(f"视频生成失败: {error_info.get('message', '未知错误')}")
                return None
            
            # 检查响应结果
            response = status_info.get('response', {})
            generated_videos = response.get('generatedVideos', [])
            
            if generated_videos and len(generated_videos) > 0:
                generated_video = generated_videos[0]
                video_data = generated_video.get('video', {})
                
                # 查找视频数据
                video_uri = None
                if 'videoBytes' in video_data and video_data['videoBytes'] != '<base64>':
                    video_uri = f"data:video/mp4;base64,{video_data['videoBytes']}"
                elif 'uri' in video_data:
                    video_uri = video_data['uri']
                
                if video_uri:
                    print("视频生成完成！")
                    break
                else:
                    print("未找到视频数据")
                    return None
            else:
                print("响应中未找到生成的视频")
                return None
        
        time.sleep(15)  # 等待15秒后再次检查
    else:
        print("视频生成超时")
        return None
    
    # 3. 下载视频
    operation_id = operation_name.split('/')[-1]
    output_path = f"veo3_video_{operation_id}.mp4"
    
    if download_veo3_video(video_uri, output_path):
        return output_path
    
    return None

def generate_with_reference_image(prompt, image_path, parameters=None):
    """
    使用参考图片生成视频
    
    Args:
        prompt: 视频描述文本
        image_path: 参考图片路径
        parameters: 视频生成参数
        
    Returns:
        任务操作信息
    """
    if not Path(image_path).exists():
        print(f"参考图片不存在: {image_path}")
        return None
    
    # 读取并编码图片
    with open(image_path, "rb") as f:
        image_data = base64.b64encode(f.read()).decode('utf-8')
    
    # 获取图片MIME类型
    mime_type = "image/jpeg"
    if image_path.lower().endswith('.png'):
        mime_type = "image/png"
    elif image_path.lower().endswith('.webp'):
        mime_type = "image/webp"
    
    url = f"{BASE_URL}/models/veo-3.1-generate-preview:predictLongRunning"
    headers = {
        "Content-Type": "application/json",
        "Authorization": f"Bearer {API_KEY}"
    }
    
    # 默认参数
    default_parameters = {
        "aspectRatio": "16:9",
        "durationSeconds": 4,
        "enhancePrompt": True,
        "resolution": "1080p",
        "sampleCount": 1,
        "compressionQuality": "OPTIMIZED"
    }
    
    if parameters:
        default_parameters.update(parameters)
    
    data = {
        "instances": [
            {
                "prompt": prompt,
                "image": {
                    "bytesBase64Encoded": image_data,
                    "mimeType": mime_type
                }
            }
        ],
        "parameters": default_parameters
    }
    
    try:
        response = requests.post(url, headers=headers, json=data)
        
        if response.status_code == 200:
            result = response.json()
            print(f"带参考图片的Veo-3视频生成任务已启动")
            print(f"操作名称: {result.get('name', 'N/A')}")
            return result
        else:
            print(f"错误: {response.status_code} - {response.text}")
            return None
            
    except Exception as e:
        print(f"请求失败: {e}")
        return None

# 使用示例
if __name__ == "__main__":
    print("=== Veo-3 视频生成示例 ===\n")
    
    # 示例1: 基础文本到视频生成
    prompt1 = "生成一个航海王路飞端着一条大鱼的短视频，背景是大海和天空"
    parameters1 = {
        "aspectRatio": "16:9",
        "durationSeconds": 4,
        "enhancePrompt": True,
        "resolution": "1080p",
        "seed": 12345
    }
    
    print("示例1: 基础文本到视频生成")
    video_path1 = generate_veo3_video_complete(prompt1, parameters1)
    
    if video_path1:
        print(f"视频生成成功: {video_path1}")
    else:
        print("视频生成失败")
    
    print("\n" + "="*50 + "\n")
    
    # 示例2: 高分辨率长视频生成
    prompt2 = "一只可爱的小猫在花园里慢慢走动，阳光透过树叶洒下斑驳的光影，电影级别的画质"
    parameters2 = {
        "aspectRatio": "16:9",
        "durationSeconds": 8,  # 8秒视频
        "enhancePrompt": True,
        "resolution": "1080p",
        "compressionQuality": "HIGH_QUALITY"
    }
    
    print("示例2: 高分辨率长视频生成")
    video_path2 = generate_veo3_video_complete(prompt2, parameters2)
    
    if video_path2:
        print(f"高质量视频生成成功: {video_path2}")
    else:
        print("高质量视频生成失败")
    
    print("\n" + "="*50 + "\n")
    
    # 示例3: 带参考图片的视频生成
    print("示例3: 带参考图片的视频生成")
    reference_image = "reference_image.jpg"  # 请确保文件存在
    
    if Path(reference_image).exists():
        prompt3 = "根据参考图片生成一段动态视频，保持图片中的主要元素和构图"
        result3 = generate_with_reference_image(prompt3, reference_image)
        
        if result3:
            operation_name = result3.get('name')
            print(f"带参考图片的任务已启动: {operation_name}")
            # 可以继续使用 generate_veo3_video_complete 的等待和下载逻辑
        else:
            print("带参考图片的视频生成启动失败")
    else:
        print(f"参考图片不存在: {reference_image}")
```


```javascript JavaScript/Node.js
const axios = require('axios');
const fs = require('fs');
const path = require('path');

const API_KEY = '<API-KEY>';
const BASE_URL = 'https://api.tokenops.ai/v1beta';

async function generateVeo3Video(prompt, parameters = {}) {
    const url = `${BASE_URL}/models/veo-3.1-generate-preview:predictLongRunning`;
    
    // 默认参数
    const defaultParameters = {
        aspectRatio: '16:9',
        durationSeconds: 4,
        enhancePrompt: true,
        resolution: '1080p',
        sampleCount: 1,
        compressionQuality: 'OPTIMIZED',
        ...parameters
    };
    
    const data = {
        instances: [
            {
                prompt: prompt
            }
        ],
        parameters: defaultParameters
    };
    
    try {
        const response = await axios.post(url, data, {
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${API_KEY}`
            }
        });
        
        console.log('Veo-3视频生成任务已启动');
        console.log(`操作名称: ${response.data.name || 'N/A'}`);
        
        return response.data;
    } catch (error) {
        console.error('Veo-3视频生成失败:', error.response?.data || error.message);
        return null;
    }
}

async function checkVeo3OperationStatus(operationName) {
    // 提取operation_id
    const operationId = operationName.split('/').pop();
    const url = `${BASE_URL}/projects/gcp-quwan-gemini/locations/us-central1/publishers/google/models/veo-3.1-generate-preview/operations/${operationId}`;
    
    try {
        const response = await axios.get(url, {
            headers: {
                'Authorization': `Bearer ${API_KEY}`
            }
        });
        
        return response.data;
    } catch (error) {
        console.error('状态查询失败:', error.response?.data || error.message);
        return null;
    }
}

async function downloadVeo3Video(videoUri, outputPath = 'veo3_generated_video.mp4') {
    try {
        if (videoUri.startsWith('data:')) {
            // 处理base64编码的视频数据
            const [header, encoded] = videoUri.split(',');
            const videoData = Buffer.from(encoded, 'base64');
            
            fs.writeFileSync(outputPath, videoData);
            console.log(`视频已保存: ${outputPath}`);
            return true;
        } else {
            // 处理HTTP URL
            const response = await axios.get(videoUri, {
                responseType: 'stream'
            });
            
            const writer = fs.createWriteStream(outputPath);
            response.data.pipe(writer);
            
            return new Promise((resolve, reject) => {
                writer.on('finish', () => {
                    console.log(`视频已保存: ${outputPath}`);
                    resolve(true);
                });
                writer.on('error', reject);
            });
        }
    } catch (error) {
        console.error('视频下载失败:', error.message);
        return false;
    }
}

async function generateVeo3VideoComplete(prompt, parameters = {}, maxWaitTime = 600000) {
    console.log('开始使用Veo-3生成视频...');
    
    // 1. 启动视频生成
    const result = await generateVeo3Video(prompt, parameters);
    if (!result || !result.name) {
        return null;
    }
    
    const operationName = result.name;
    
    // 2. 等待视频生成完成
    console.log('正在生成视频，请耐心等待...');
    const startTime = Date.now();
    
    while (Date.now() - startTime < maxWaitTime) {
        const statusInfo = await checkVeo3OperationStatus(operationName);
        if (!statusInfo) {
            break;
        }
        
        const done = statusInfo.done || false;
        console.log(`任务状态: ${done ? '完成' : '进行中'}`);
        
        if (done) {
            // 检查是否有错误
            if (statusInfo.error) {
                console.error(`视频生成失败: ${statusInfo.error.message || '未知错误'}`);
                return null;
            }
            
            // 检查响应结果
            const response = statusInfo.response || {};
            const generatedVideos = response.generatedVideos || [];
            
            if (generatedVideos.length > 0) {
                const generatedVideo = generatedVideos[0];
                const videoData = generatedVideo.video || {};
                
                // 查找视频数据
                let videoUri = null;
                if (videoData.videoBytes && videoData.videoBytes !== '<base64>') {
                    videoUri = `data:video/mp4;base64,${videoData.videoBytes}`;
                } else if (videoData.uri) {
                    videoUri = videoData.uri;
                }
                
                if (videoUri) {
                    console.log('视频生成完成！');
                    
                    // 3. 下载视频
                    const operationId = operationName.split('/').pop();
                    const outputPath = `veo3_video_${operationId}.mp4`;
                    
                    const success = await downloadVeo3Video(videoUri, outputPath);
                    return success ? outputPath : null;
                } else {
                    console.error('未找到视频数据');
                    return null;
                }
            } else {
                console.error('响应中未找到生成的视频');
                return null;
            }
        }
        
        await new Promise(resolve => setTimeout(resolve, 15000)); // 等待15秒
    }
    
    console.error('视频生成超时');
    return null;
}

async function generateWithReferenceImage(prompt, imagePath, parameters = {}) {
    if (!fs.existsSync(imagePath)) {
        console.error(`参考图片不存在: ${imagePath}`);
        return null;
    }
    
    // 读取并编码图片
    const imageData = fs.readFileSync(imagePath, { encoding: 'base64' });
    
    // 获取图片MIME类型
    let mimeType = 'image/jpeg';
    const ext = path.extname(imagePath).toLowerCase();
    if (ext === '.png') {
        mimeType = 'image/png';
    } else if (ext === '.webp') {
        mimeType = 'image/webp';
    }
    
    const url = `${BASE_URL}/models/veo-3.1-generate-preview:predictLongRunning`;
    
    // 默认参数
    const defaultParameters = {
        aspectRatio: '16:9',
        durationSeconds: 4,
        enhancePrompt: true,
        resolution: '1080p',
        sampleCount: 1,
        compressionQuality: 'OPTIMIZED',
        ...parameters
    };
    
    const data = {
        instances: [
            {
                prompt: prompt,
                image: {
                    bytesBase64Encoded: imageData,
                    mimeType: mimeType
                }
            }
        ],
        parameters: defaultParameters
    };
    
    try {
        const response = await axios.post(url, data, {
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${API_KEY}`
            }
        });
        
        console.log('带参考图片的Veo-3视频生成任务已启动');
        console.log(`操作名称: ${response.data.name || 'N/A'}`);
        
        return response.data;
    } catch (error) {
        console.error('带参考图片的视频生成失败:', error.response?.data || error.message);
        return null;
    }
}

// 使用示例
(async () => {
    try {
        console.log('=== Veo-3 视频生成示例 ===\n');
        
        // 示例1: 基础文本到视频生成
        console.log('示例1: 基础文本到视频生成');
        const prompt1 = '生成一个航海王路飞端着一条大鱼的短视频，背景是大海和天空';
        const parameters1 = {
            aspectRatio: '16:9',
            durationSeconds: 4,
            enhancePrompt: true,
            resolution: '1080p',
            seed: 12345
        };
        
        const videoPath1 = await generateVeo3VideoComplete(prompt1, parameters1);
        
        if (videoPath1) {
            console.log(`视频生成成功: ${videoPath1}`);
        } else {
            console.log('视频生成失败');
        }
        
        console.log('\n' + '='.repeat(50) + '\n');
        
        // 示例2: 高分辨率长视频生成
        console.log('示例2: 高分辨率长视频生成');
        const prompt2 = '一只可爱的小猫在花园里慢慢走动，阳光透过树叶洒下斑驳的光影，电影级别的画质';
        const parameters2 = {
            aspectRatio: '16:9',
            durationSeconds: 8, // 8秒视频
            enhancePrompt: true,
            resolution: '1080p',
            compressionQuality: 'HIGH_QUALITY'
        };
        
        const videoPath2 = await generateVeo3VideoComplete(prompt2, parameters2);
        
        if (videoPath2) {
            console.log(`高质量视频生成成功: ${videoPath2}`);
        } else {
            console.log('高质量视频生成失败');
        }
        
    } catch (error) {
        console.error('程序执行出错:', error.message);
    }
})();
```


```go Go
package main

import (
    "bytes"
    "encoding/base64"
    "encoding/json"
    "fmt"
    "io"
    "net/http"
    "os"
    "path/filepath"
    "strings"
    "time"
)

const (
    APIKey  = "<API-KEY>"
    BaseURL = "https://api.tokenops.ai/v1beta"
)

// Veo3请求结构体
type veo3Request struct {
    Instances  []veo3Instance  `json:"instances"`
    Parameters veo3Parameters `json:"parameters"`
}

type veo3Instance struct {
    Prompt string     `json:"prompt"`
    Image  *veo3Asset `json:"image,omitempty"`
}

type veo3Asset struct {
    BytesBase64Encoded string `json:"bytesBase64Encoded,omitempty"`
    MimeType           string `json:"mimeType,omitempty"`
}

type veo3Parameters struct {
    AspectRatio        string `json:"aspectRatio,omitempty"`
    DurationSeconds    int    `json:"durationSeconds,omitempty"`
    EnhancePrompt      bool   `json:"enhancePrompt,omitempty"`
    Resolution         string `json:"resolution,omitempty"`
    SampleCount        int    `json:"sampleCount,omitempty"`
    Seed               uint32 `json:"seed,omitempty"`
    CompressionQuality string `json:"compressionQuality,omitempty"`
}

// Veo3响应结构体
type veo3Response struct {
    Name string `json:"name"`
    Done bool   `json:"done"`
    Error *struct {
        Code    int    `json:"code"`
        Message string `json:"message"`
    } `json:"error,omitempty"`
    Response *struct {
        GeneratedVideos []struct {
            Video struct {
                MimeType   string `json:"mimeType,omitempty"`
                URI        string `json:"uri,omitempty"`
                VideoBytes string `json:"videoBytes,omitempty"`
            } `json:"video"`
        } `json:"generatedVideos"`
    } `json:"response,omitempty"`
}

func generateveo3Video(prompt string, parameters veo3Parameters) (*veo3Response, error) {
    url := fmt.Sprintf("%s/models/veo-3.1-generate-preview:predictLongRunning", BaseURL)
    
    // 设置默认参数
    if parameters.AspectRatio == "" {
        parameters.AspectRatio = "16:9"
    }
    if parameters.DurationSeconds == 0 {
        parameters.DurationSeconds = 4
    }
    if parameters.Resolution == "" {
        parameters.Resolution = "1080p"
    }
    if parameters.SampleCount == 0 {
        parameters.SampleCount = 1
    }
    if parameters.CompressionQuality == "" {
        parameters.CompressionQuality = "OPTIMIZED"
    }
    
    request := veo3Request{
        Instances: []veo3Instance{
            {
                Prompt: prompt,
            },
        },
        Parameters: parameters,
    }
    
    jsonData, err := json.Marshal(request)
    if err != nil {
        return nil, fmt.Errorf("编码请求失败: %v", err)
    }
    
    req, err := http.NewRequest("POST", url, bytes.NewBuffer(jsonData))
    if err != nil {
        return nil, fmt.Errorf("创建请求失败: %v", err)
    }
    
    req.Header.Set("Content-Type", "application/json")
    req.Header.Set("Authorization", fmt.Sprintf("Bearer %s", APIKey))
    
    client := &http.Client{}
    resp, err := client.Do(req)
    if err != nil {
        return nil, fmt.Errorf("请求失败: %v", err)
    }
    defer resp.Body.Close()
    
    responseBody, err := io.ReadAll(resp.Body)
    if err != nil {
        return nil, fmt.Errorf("读取响应失败: %v", err)
    }
    
    if resp.StatusCode != 200 {
        return nil, fmt.Errorf("API错误: %d - %s", resp.StatusCode, string(responseBody))
    }
    
    var result veo3Response
    if err := json.Unmarshal(responseBody, &result); err != nil {
        return nil, fmt.Errorf("解析响应失败: %v", err)
    }
    
    fmt.Printf("Veo-3视频生成任务已启动\n")
    fmt.Printf("操作名称: %s\n", result.Name)
    
    return &result, nil
}

func checkveo3OperationStatus(operationName string) (*veo3Response, error) {
    // 提取operation_id
    parts := strings.Split(operationName, "/")
    operationID := parts[len(parts)-1]
    
    url := fmt.Sprintf("%s/projects/gcp-quwan-gemini/locations/us-central1/publishers/google/models/veo-3.1-generate-preview/operations/%s", BaseURL, operationID)
    
    req, err := http.NewRequest("GET", url, nil)
    if err != nil {
        return nil, fmt.Errorf("创建请求失败: %v", err)
    }
    
    req.Header.Set("Authorization", fmt.Sprintf("Bearer %s", APIKey))
    
    client := &http.Client{}
    resp, err := client.Do(req)
    if err != nil {
        return nil, fmt.Errorf("请求失败: %v", err)
    }
    defer resp.Body.Close()
    
    responseBody, err := io.ReadAll(resp.Body)
    if err != nil {
        return nil, fmt.Errorf("读取响应失败: %v", err)
    }
    
    if resp.StatusCode != 200 {
        return nil, fmt.Errorf("API错误: %d - %s", resp.StatusCode, string(responseBody))
    }
    
    var result veo3Response
    if err := json.Unmarshal(responseBody, &result); err != nil {
        return nil, fmt.Errorf("解析响应失败: %v", err)
    }
    
    return &result, nil
}

func downloadveo3Video(videoURI, outputPath string) error {
    if strings.HasPrefix(videoURI, "data:") {
        // 处理base64编码的视频数据
        parts := strings.Split(videoURI, ",")
        if len(parts) != 2 {
            return fmt.Errorf("无效的data URI格式")
        }
        
        videoData, err := base64.StdEncoding.DecodeString(parts[1])
        if err != nil {
            return fmt.Errorf("base64解码失败: %v", err)
        }
        
        err = os.WriteFile(outputPath, videoData, 0644)
        if err != nil {
            return fmt.Errorf("写入文件失败: %v", err)
        }
        
        fmt.Printf("视频已保存: %s\n", outputPath)
        return nil
    } else {
        // 处理HTTP URL
        resp, err := http.Get(videoURI)
        if err != nil {
            return fmt.Errorf("下载失败: %v", err)
        }
        defer resp.Body.Close()
        
        if resp.StatusCode != 200 {
            return fmt.Errorf("下载失败: %d", resp.StatusCode)
        }
        
        file, err := os.Create(outputPath)
        if err != nil {
            return fmt.Errorf("创建文件失败: %v", err)
        }
        defer file.Close()
        
        _, err = io.Copy(file, resp.Body)
        if err != nil {
            return fmt.Errorf("写入文件失败: %v", err)
        }
        
        fmt.Printf("视频已保存: %s\n", outputPath)
        return nil
    }
}

func generateveo3VideoComplete(prompt string, parameters veo3Parameters, maxWaitTime time.Duration) (string, error) {
    fmt.Println("开始使用Veo-3生成视频...")
    
    // 1. 启动视频生成
    result, err := generateveo3Video(prompt, parameters)
    if err != nil {
        return "", fmt.Errorf("启动视频生成失败: %v", err)
    }
    
    operationName := result.Name
    if operationName == "" {
        return "", fmt.Errorf("未获取到操作名称")
    }
    
    // 2. 等待视频生成完成
    fmt.Println("正在生成视频，请耐心等待...")
    startTime := time.Now()
    
    var videoURI string
    
    for time.Since(startTime) < maxWaitTime {
        statusInfo, err := checkveo3OperationStatus(operationName)
        if err != nil {
            return "", fmt.Errorf("查询状态失败: %v", err)
        }
        
        done := statusInfo.Done
        fmt.Printf("任务状态: %s\n", map[bool]string{true: "完成", false: "进行中"}[done])
        
        if done {
            // 检查是否有错误
            if statusInfo.Error != nil {
                return "", fmt.Errorf("视频生成失败: %s", statusInfo.Error.Message)
            }
            
            // 检查响应结果
            if statusInfo.Response != nil && len(statusInfo.Response.GeneratedVideos) > 0 {
                generatedVideo := statusInfo.Response.GeneratedVideos[0]
                videoData := generatedVideo.Video
                
                if videoData.VideoBytes != "" && videoData.VideoBytes != "<base64>" {
                    videoURI = fmt.Sprintf("data:video/mp4;base64,%s", videoData.VideoBytes)
                } else if videoData.URI != "" {
                    videoURI = videoData.URI
                }
                
                if videoURI != "" {
                    fmt.Println("视频生成完成！")
                    break
                } else {
                    return "", fmt.Errorf("未找到视频数据")
                }
            } else {
                return "", fmt.Errorf("响应中未找到生成的视频")
            }
        }
        
        time.Sleep(15 * time.Second)
    }
    
    if videoURI == "" {
        return "", fmt.Errorf("视频生成超时")
    }
    
    // 3. 下载视频
    parts := strings.Split(operationName, "/")
    operationID := parts[len(parts)-1]
    outputPath := fmt.Sprintf("veo3_video_%s.mp4", operationID)
    
    if err := downloadveo3Video(videoURI, outputPath); err != nil {
        return "", fmt.Errorf("下载视频失败: %v", err)
    }
    
    return outputPath, nil
}

func main() {
    fmt.Println("=== Veo-3 视频生成示例 ===")
    
    // 示例: 基础文本到视频生成
    prompt := "生成一个航海王路飞端着一条大鱼的短视频，背景是大海和天空"
    parameters := veo3Parameters{
        AspectRatio:        "16:9",
        DurationSeconds:    4,
        EnhancePrompt:      true,
        Resolution:         "1080p",
        Seed:               12345,
        CompressionQuality: "OPTIMIZED",
    }
    
    videoPath, err := generateveo3VideoComplete(prompt, parameters, 10*time.Minute)
    if err != nil {
        fmt.Printf("视频生成失败: %v\n", err)
        return
    }
    
    fmt.Printf("视频生成成功: %s\n", videoPath)
}
```

</CodeGroup>

## 支持的参数

- **aspectRatio**: 视频宽高比（如 "16:9", "9:16", "1:1"）
- **durationSeconds**: 视频时长（秒，支持4-8秒）
- **enhancePrompt**: 是否增强提示词（建议设为true）
- **resolution**: 视频分辨率（如 "1080p", "720p"）
- **sampleCount**: 生成样本数量（通常为1）
- **seed**: 随机种子（用于可重复生成）
- **compressionQuality**: 压缩质量（"OPTIMIZED", "HIGH_QUALITY"）

## 视频生成流程

1. **提交任务**: 发送predictLongRunning请求，获得操作名称
2. **等待处理**: 轮询操作状态直到完成
3. **下载视频**: 从响应中提取视频数据并保存

## 响应示例

### 任务提交响应

```json
{
  "name": "projects/gcp-quwan-gemini/locations/us-central1/publishers/google/models/veo-3.1-generate-preview/operations/2cd6428a-24c4-4a35-be15-65b62861c2ba"
}
```

### 状态查询响应（进行中）

```json
{
  "name": "projects/gcp-quwan-gemini/locations/us-central1/publishers/google/models/veo-3.1-generate-preview/operations/2cd6428a-24c4-4a35-be15-65b62861c2ba",
  "done": false
}
```

### 状态查询响应（完成）

```json
{
  "done": true,
  "name": "projects/gcp-quwan-gemini/locations/us-central1/publishers/google/models/veo-3.1-generate-preview/operations/2cd6428a-24c4-4a35-be15-65b62861c2ba",
  "response": {
    "generatedVideos": [
      {
        "video": {
          "mimeType": "video/mp4",
          "uri": "xxx",
          "videoBytes": "<base64>"

        }
      }

    ]
  }
}
```

## 应用场景

- **内容创作**: 社交媒体短视频、营销内容制作
- **教育培训**: 教学动画、演示视频生成
- **广告制作**: 产品宣传片、品牌视频创建
- **娱乐内容**: 动画短片、创意视频制作
- **原型设计**: 概念验证、创意可视化

## 最佳实践

### 1. 提示词优化

- 使用具体、生动的描述
- 包含动作、场景、风格要求
- 描述视觉细节和氛围

```text
好的提示词示例：
"一只橙色的小猫在绿色的花园里优雅地走动，金色的阳光透过树叶洒下，营造温暖的午后氛围，电影级画质"
```

### 2. 参考图片使用

- 支持 JPG、PNG、WebP 格式
- 建议分辨率至少 512x512
- 图片内容应与视频主题相关

### 3. 参数配置建议

- **高质量视频**: 使用 "HIGH_QUALITY" 压缩
- **快速生成**: 使用 "OPTIMIZED" 压缩
- **可重复生成**: 设置固定的seed值
- **长视频**: 设置durationSeconds为6-8秒

## 注意事项

1. **生成时间**: Veo-3视频生成通常需要5-15分钟
2. **文件格式**: 生成的视频为MP4格式，支持高分辨率
3. **内容政策**: 确保提示词符合Google的使用政策
4. **API限制**: 注意并发请求数和频率限制
5. **存储建议**: 及时下载和保存生成的视频

## 错误处理

常见错误和解决方案：

- **400 Bad Request**: 检查请求参数格式和内容
- **401 Unauthorized**: 验证API密钥是否正确
- **429 Too Many Requests**: 降低请求频率
- **500 Internal Server Error**: 稍后重试或联系支持

## Veo-3 特色功能

### 1. 高级参数控制

- 支持多种分辨率和宽高比
- 可调节的压缩质量
- 智能提示词增强

### 2. 参考图片生成

- 基于图片生成相关视频
- 保持图片中的关键元素
- 支持多种图片格式

### 3. 长时长支持

- 支持最长8秒的视频生成
- 高质量的运动连贯性
- 适合复杂场景表现

## 费用说明

Veo-3 视频生成按时长和分辨率计费，具体费用请参考最新的定价页面。高分辨率和长时长视频会产生更高的费用。